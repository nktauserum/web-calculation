# Оркестратор и Агент для Калькулятора

Этот проект реализует оркестратор и агента для выполнения арифметических выражений. Оркестратор отвечает за разбиение выражений на подзадачи, управление порядком их выполнения и координацию работы агентов. Агент выполняет вычисления и отправляет результаты обратно оркестратору.

[![Telegram](https://raw.githubusercontent.com/CLorant/readme-social-icons/refs/heads/main/small/filled/telegram.svg)](https://t.me/Auserum) [**Telegram**: @Auserum](https://t.me/Auserum)

## Структура проекта

Проект состоит из двух основных компонентов:

- **Оркестратор:** Отвечает за прием арифметических выражений, их разбор, формирование очереди задач и управление выполнением задач агентами.
- **Агент:** Демон, который получает задачи от оркестратора, выполняет вычисления и отправляет результаты обратно оркестратору.

## Алгоритм работы оркестратора

1. **Разбор выражения:** Разбивает входное арифметическое выражение на подзадачи, используя обратную польскую нотацию (RPN). Результаты промежуточных вычислений обозначаются идентификаторами (ID).
2. **Формирование очереди задач:** Обеспечивает правильный порядок выполнения задач. Задачи, зависящие от результатов других задач, выполняются после завершения зависимых задач.
3. **Управление статусами задач:** Отслеживает статус каждой задачи (выполнена/не выполнена).
4. **Взаимодействие с агентами:** Предоставляет агентам задачи для выполнения и принимает от них результаты.

## Алгоритм работы агента

1. **Запрос задачи:** Агент постоянно запрашивает задачи у оркестратора (GET `/internal/task`).
2. **Выполнение вычислений:** Получив задачу, агент выполняет вычисления.
3. **Отправка результата:** Отправляет результат вычислений оркестратору (POST `/internal/task`).

## Взаимодействие между агентом и оркестратором

Агент общается с оркестратором по протоколу HTTP.

- **Получение релевантной задачи:** `GET /internal/task`
- **Отправка результата:** `POST /internal/task`

## Запуск проекта

##### 1. Запустите оркестратор в терминале

```sh
make orchestrator
```

или

```sh
go run orchestrator/cmd/orchestrator.go
```

##### 2. Запустите агент в другом терминале

```sh
make agent
```

или

```sh
go run agent/cmd/agent.go
```

**Теперь можете выполнить запрос!**

## Примеры использования оркестратора на порту :8080

Для запросов к серверу можно использовать консольную утилиту _curl_, можно графические утилиты, навроде _Postman_. Примеры приведены для _curl_. Используйте то, что вам удобнее.

По умолчанию используется порт **8080**, если у вас он занят, можете сменить его в файле [config.json](shared/config/config.json).

- **GET** Отправляем выражение (статус 201 Created). В ответ получаем ID созданной задачи

```bash
# Корректное выражение
curl --location http://localhost:8080/api/v1/calculate \
  -H "Content-Type: application/json" \
  -d '{
        "expression": "2 * (3 + 4) * 5"
      }'

# Недопустимый символ, вернётся ошибка
curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{"expression": "2+2*a"}'
```

- **GET** Получаем выражение (статус 200 OK). Получаем выражение по его ID, в случае его отсутствия выдаём статус 404.

```bash
curl http://localhost:8080/api/v1/expressions/:id
```

- **GET** Получаем список выражений (статус 200 OK). Получаем массив с выражениями

```bash
curl http://localhost:8080/api/v1/expressions
```

Когда переданное выражение будет посчитано, оно приобретёт в списке статус `true` и результат в специальном поле.
